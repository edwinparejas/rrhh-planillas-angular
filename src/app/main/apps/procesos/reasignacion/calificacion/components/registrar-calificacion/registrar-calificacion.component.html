
<div class="page-layout carded fullwidth inner-scroll p-16" mineduPerfectScrollbar>
    <div class="page-layout carded left-sidebar inner-scroll">
        <div class="content" mineduPerfectScrollbar>
            <div class="panel">
                <div class="panel-body">
                    <mat-tab-group>
                        <mat-tab [label]=dialogTitle>
                        <div class="panel-body">
                            <div fxLayout="column">
                                <fieldset class="fieldset-border mb-3" *ngIf="spublico">
                                    <legend>Datos personales</legend>
                                    <div fxLayout="row" fxLayout.lt-md="column" fxFlex="100%" fxLayoutGap="12px"
                                        fxLayoutGap.lt-md="0">
                                        <div fxLayout="row" fxLayout.lt-sm="column" fxFlex="100%" fxFlex.lt-sm="100%"
                                            fxLayoutGap="12px">
                                            <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                <div>
                                                    <span style="font-weight: bold">Documento de identidad</span>&nbsp;
                                                    <br />
                                                    <span>{{ spublico.tipoDocumentoIdentidad }}:
                                                        {{spublico.numeroDocumentoIdentidad}} </span>
                                                </div>
                                            </div>
                                            <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                <div>
                                                    <span style="font-weight: bold">Primer apellido</span>
                                                    <br />
                                                    <span>{{ spublico.primerApellido }} </span>
                                                </div>
                                            </div>
                                            <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                <div>
                                                    <span style="font-weight: bold">Segundo apellido</span>
                                                    <br />
                                                    <span>{{ spublico.segundoApellido }} </span>
                                                </div>
                                            </div>
                                            <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                <div>
                                                    <span style="font-weight: bold">Nombres</span>
                                                    <br />
                                                    <span>{{ spublico.nombres }} </span>
                                                </div>
                                            </div>
                                            <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                <div>
                                                    <span style="font-weight: bold">Sexo</span>
                                                    <br />
                                                    <span>{{ spublico.generoPersona }} </span>
                                                </div>
                                            </div>
                                        </div>
                                        <br />
                                    </div>
                                </fieldset>

                                <fieldset class="fieldset-border" *ngIf="plaza">
                                    <legend>Datos laborales (actual)</legend>
                                    <div fxLayout="column">
                                        <div fxLayout="row" fxLayout.lt-md="column" fxFlex="100%" fxLayoutGap="12px"
                                            fxLayoutGap.lt-md="0">
                                            <div fxLayout="row" fxLayout.lt-sm="column" fxFlex="100%" fxFlex.lt-sm="100%"
                                                fxLayoutGap="12px">
                                                <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                    <div>
                                                        <span style="font-weight: bold">Código plaza</span>&nbsp;
                                                        <br />
                                                        <span>{{ plaza.codigoPlaza }} </span>
                                                    </div>
                                                </div>
                                                <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                    <div>
                                                        <span style="font-weight: bold">Régimen laboral</span>
                                                        <br />
                                                        <span>{{ plaza.regimenLaboral }} </span>
                                                    </div>
                                                </div>
                                                <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                    <div>
                                                        <span style="font-weight: bold">Cargo</span>
                                                        <br />
                                                        <span>{{ plaza.cargo }} </span>
                                                    </div>
                                                </div>
                                                <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                    <div>
                                                        <span style="font-weight: bold">Condición laboral</span>
                                                        <br />
                                                        <span>{{ plaza.condicionPlaza }} </span>
                                                    </div>
                                                </div>
                                                <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                    <div>
                                                        <span style="font-weight: bold">Situación laboral</span>
                                                        <br />
                                                        <span>{{ spublico.situacionLaboral }} </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <br />
                                        <div fxLayout="row" fxLayout.lt-md="column" fxFlex="100%" fxLayoutGap="12px"
                                            fxLayoutGap.lt-md="0">
                                            <div fxLayout="row" fxLayout.lt-sm="column" fxFlex="100%" fxFlex.lt-sm="100%"
                                                fxLayoutGap="12px">
                                                <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                    <div>
                                                        <span style="font-weight: bold">Escala remunerativa</span>
                                                        <br />
                                                        <span>{{ spublico.descripcionCategoriaRemunerativa }} </span>
                                                    </div>
                                                </div>
                                                <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                    <div>
                                                        <span style="font-weight: bold">Código modular</span>
                                                        <br />
                                                        <span>{{ plaza.codigoModular }} </span>
                                                    </div>
                                                </div>
                                                <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                    <div>
                                                        <span style="font-weight: bold">Centro de trabajo</span>
                                                        <br />
                                                        <span>{{ plaza.centroTrabajo }} </span>
                                                    </div>
                                                </div>
                                                <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                    <div>
                                                        <span style="font-weight: bold">Instancia</span>
                                                        <br />
                                                        <span>{{ plaza.instancia }} </span>
                                                    </div>
                                                </div>
                                                <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                    <div>
                                                        <span style="font-weight: bold">Sub Instancia</span>
                                                        <br />
                                                        <span>{{ plaza.subinstancia }} </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <br />
                                        <div fxLayout="row" fxLayout.lt-md="column" fxFlex="100%" fxLayoutGap="12px"
                                            fxLayoutGap.lt-md="0">
                                            <div fxLayout="row" fxLayout.lt-sm="column" fxFlex="100%" fxFlex.lt-sm="100%"
                                                fxLayoutGap="12px">
                                                <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                    <div>
                                                        <span style="font-weight: bold">Tipo de Plaza</span>&nbsp;
                                                        <br />
                                                        <span>{{ plaza.tipoPlaza }} </span>
                                                    </div>
                                                </div>
                                                <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                    <div>
                                                        <span style="font-weight: bold">Vigencia Inicio</span>
                                                        <br />
                                                        <span>{{ plaza.vigenciaInicio | date: 'dd/MM/yyyy'}} </span>
                                                    </div>
                                                </div>
                                                <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                    <div>
                                                        <span style="font-weight: bold"></span>
                                                        <br />
                                                        <span> </span>
                                                    </div>
                                                </div>
                                                <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                    <div>
                                                        <span style="font-weight: bold"></span>
                                                        <br />
                                                        <span> </span>
                                                    </div>
                                                </div>
                                                <div fxLayoutAlign="start start" fxFlex="20%" fxFlex.xs="100%">
                                                    <div>
                                                        <span style="font-weight: bold"></span>
                                                        <br />
                                                        <span> </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <br />
                                    </div>
                                </fieldset>
                            </div>
                            <br />
                        <br />
                        <form autocomplete="off" novalidate [formGroup]="form">
                            <div class="vertical">
                                <mat-tab-group mat-align-tabs="start" (selectedTabChange)="onTabChanged($event)"
                                [(selectedIndex)]="selectedTabIndex" animationDuration="0ms" dynamicHeight>
                                    <mat-tab label="1. Requisitos Generales">
                                        <div class="content">
                                            <div class="content-table">
                                                <div fxLayout="column">
                                                    <ng-container formArrayName="requisitosGenerales">
                                                        <table mat-table class="minedu-table" #table
                                                            [dataSource]="requisitosGenerales.controls"
                                                            [@animateStagger]="{ value: '50' }" style="width: 100%">

                                                            <ng-container matColumnDef="numero">
                                                                <th mat-header-cell *matHeaderCellDef>
                                                                    Nro
                                                                </th>
                                                                <td mat-cell *matCellDef=" let row; let i = index">
                                                                    <p> {{ row.get('codigoCriterio').value }} </p>
                                                                </td>
                                                            </ng-container>

                                                            <ng-container matColumnDef="requisitosGenerales">
                                                                <th mat-header-cell *matHeaderCellDef>Requisitos
                                                                    Generales
                                                                </th>
                                                                <td mat-cell *matCellDef="let row;let i = index ">
                                                                    <p> {{ row.get('descripcionCriterio').value }} </p>
                                                                </td>
                                                            </ng-container>
                                                            <ng-container matColumnDef="cumple">
                                                                <th mat-header-cell *matHeaderCellDef>Cumple
                                                                </th>
                                                                <td mat-cell *matCellDef="let row;let rowIndex = index "
                                                                    [formGroup]="row">
                                                                    <div>
                                                                        <mat-checkbox formControlName="acreditaDocumento"
                                                                            [disabled]="esDesabilitado"
                                                                            (click)="handleAcreditaDocumentoRequisitosGenerales($event, row)"
                                                                            (change)="$event ? selectionRequisitosGenerales.toggle(row) : null"
                                                                            [checked]="selectionRequisitosGenerales.isSelected(row)">
                                                                        </mat-checkbox>
                                                                    </div>
                                                                </td>
                                                            </ng-container>


                                                            <tr mat-header-row
                                                                *matHeaderRowDef="displayedRequisitosGenerales;sticky: true">
                                                            </tr>
                                                            <tr mat-row
                                                                *matRowDef="let row;columns: displayedRequisitosGenerales"
                                                                (click)="handleAcreditaDocumentoRequisitosGenerales($event, row)"
                                                                [ngClass]="{ hovered: row.hovered,selected: selectionRequisitosGenerales.isSelected(row)}"
                                                                (mouseover)=" row.hovered = true "
                                                                (mouseout)="row.hovered = false"
                                                                [@animate]="{value: '*',params: { y: '100%' }}">
                                                                
                                                            </tr>
                                                        </table>
                                                    </ng-container>
                                                    <br />
                                                    <div fxLayout="row" fxLayout.lt-md="column">
                                                        <div fxLayout="row" fxLayout.xs="column" fxFlex="100%"
                                                            fxFlex.xs="100%" fxLayoutGap="12px" fxLayoutGap.xs="0">
                                                            <mat-form-field appearance="fill" fxFlex="100%" fxFlex.xs="100%"
                                                                [mineduFormFieldValidationState]="form.get('anotacionesRequisitosGenerales')">
                                                                <mat-label
                                                                    [mineduFormRequiredLabel]="form.get('anotacionesRequisitosGenerales')">
                                                                    Anotaciones
                                                                </mat-label>
                                                                <textarea matInput
                                                                    [disabled]="esDesabilitado"
                                                                    formControlName="anotacionesRequisitosGenerales"
                                                                    maxlength="400" alphaNumeric uppercase></textarea>
                                                            </mat-form-field>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </mat-tab>
                                    <mat-tab label="2. Verificar Impedimentos">
                                        <div class="content">
                                            <div class="content-table">
                                                <div fxLayout="column">
                                                    <ng-container formArrayName="verificarImpedimentos">
                                                        <table mat-table class="minedu-table" #table
                                                            [dataSource]="verificarImpedimentos.controls"
                                                            [@animateStagger]="{ value: '50' }" style="width: 100%">

                                                            <ng-container matColumnDef="numero">
                                                                <th mat-header-cell *matHeaderCellDef>
                                                                    Nro
                                                                </th>
                                                                <td mat-cell *matCellDef=" let row; let i = index">
                                                                    <p> {{ row.get('codigoCriterio').value }} </p>
                                                                </td>
                                                            </ng-container>

                                                            <ng-container matColumnDef="verificacionImpedimentos">
                                                                <th mat-header-cell *matHeaderCellDef>Verificación 
                                                                    Impedimentos
                                                                </th>
                                                                <td mat-cell *matCellDef="let row;let i = index ">
                                                                    <p> {{ row.get('descripcionCriterio').value }} </p>
                                                                </td>
                                                            </ng-container>
                                                            <ng-container matColumnDef="cumple">
                                                                <th mat-header-cell *matHeaderCellDef>Cumple
                                                                </th>
                                                                <td mat-cell *matCellDef="let row;let rowIndex = index "
                                                                    [formGroup]="row">
                                                                    <div>
                                                                        <mat-checkbox formControlName="acreditaDocumento"
                                                                            [disabled]="esDesabilitado"
                                                                            (click)="handleAcreditaDocumentoVerificarImpedimentos($event, row)"
                                                                            (change)="$event ? selectionVerificarImpedimentos.toggle(row) : null"
                                                                            [checked]="selectionVerificarImpedimentos.isSelected(row)">
                                                                        </mat-checkbox>
                                                                    </div>
                                                                </td>
                                                            </ng-container>


                                                            <tr mat-header-row
                                                                *matHeaderRowDef="displayedVerificarImpedimentos;sticky: true">
                                                            </tr>
                                                            <tr mat-row
                                                                *matRowDef="let row;columns: displayedVerificarImpedimentos"
                                                                (click)="handleAcreditaDocumentoVerificarImpedimentos($event, row)"
                                                                [ngClass]="{ hovered: row.hovered,selected: selectionVerificarImpedimentos.isSelected(row)}"
                                                                (mouseover)=" row.hovered = true "
                                                                (mouseout)="row.hovered = false"
                                                                [@animate]="{value: '*',params: { y: '100%' }}">
                                                            </tr>
                                                        </table>
                                                    </ng-container>
                                                    <br />
                                                    <div fxLayout="row" fxLayout.lt-md="column">
                                                        <div fxLayout="row" fxLayout.xs="column" fxFlex="100%"
                                                            fxFlex.xs="100%" fxLayoutGap="12px" fxLayoutGap.xs="0">
                                                            <mat-form-field appearance="fill" fxFlex="100%" fxFlex.xs="100%"
                                                                [mineduFormFieldValidationState]="form.get('anotacionesVerificarImpedimentos')">
                                                                <mat-label
                                                                    [mineduFormRequiredLabel]="form.get('anotacionesVerificarImpedimentos')">
                                                                    Anotaciones
                                                                </mat-label>
                                                                <textarea matInput
                                                                    [disabled]="esDesabilitado"
                                                                    formControlName="anotacionesVerificarImpedimentos"
                                                                    maxlength="400" alphaNumeric uppercase></textarea>
                                                            </mat-form-field>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </mat-tab>
                                    <mat-tab label="3. Evaluación de Expediente">
                                        <div class="content">
                                            <div class="content-table">
                                                <div fxLayout="column">
                                                    <ng-container formArrayName="evaluacionExpediente">
                                                        <table mat-table class="minedu-table" #table
                                                            [dataSource]="evaluacionExpediente.controls"
                                                            [@animateStagger]="{ value: '50' }" style="width: 100%">

                                                            <ng-container matColumnDef="numero">
                                                                <th mat-header-cell *matHeaderCellDef>
                                                                    Nro
                                                                </th>
                                                                <td mat-cell *matCellDef=" let row; let i = index">
                                                                    <p> {{ row.get('codigoCriterio').value }} </p>
                                                                </td>
                                                                <td mat-footer-cell *matFooterCellDef> </td>
                                                            </ng-container>

                                                            <ng-container matColumnDef="criterioEvaluacion">
                                                                <th mat-header-cell *matHeaderCellDef>Criterio de 
                                                                    Evaluación
                                                                </th>
                                                                <td mat-cell *matCellDef="let row;let i = index ">
                                                                    <p> {{ row.get('descripcionCriterio').value }} </p>
                                                                </td>
                                                                <td mat-footer-cell *matFooterCellDef> PUNTAJE TOTAL DE
                                                                    EVALUACIÓN DE EXPEDIENTE </td>
                                                            </ng-container>

                                                            <ng-container matColumnDef="puntajeMaximo">
                                                                <th mat-header-cell *matHeaderCellDef>Puntaje máximo
                                                                </th>
                                                                <td mat-cell *matCellDef="let row;let i = index ">
                                                                    <p> {{ row.get('puntajeMaximo').value }} </p>
                                                                </td>
                                                                <td mat-footer-cell *matFooterCellDef> </td>
                                                            </ng-container>

                                                            <ng-container matColumnDef="puntajeUnidad">
                                                                <th mat-header-cell *matHeaderCellDef>Puntaje Unidad
                                                                </th>
                                                                <td mat-cell *matCellDef="let row;let i = index">
                                                                    <p *ngIf="getTieneValorMaximo(row)"> {{ row.get('puntajeMaximoUnidad').value }} {{" PUNTO POR "}} {{ row.get('unidadMedida').value }}</p>
                                                                </td>
                                                                <td mat-footer-cell *matFooterCellDef> </td>
                                                            </ng-container>

                                                            <ng-container matColumnDef="acreditaDocumento">
                                                                <th mat-header-cell *matHeaderCellDef>Acredita documento
                                                                </th>
                                                                <td mat-cell *matCellDef="let row;let rowIndex = index "
                                                                    [formGroup]="row">
                                                                        <div *ngIf="getTienePadre(row) && row.get('esSeleccionExcluyente').value">
                                                                        <mat-radio-group
                                                                            formControlName="acreditaDocumento_{{row.get('idCodigoPadre').value}}"
                                                                            name="acreditaDocumento_{{row.get('idCodigoPadre').value}}"
                                                                            >
                                                                            <mat-radio-button 
                                                                                [disabled]="esDesabilitado"
                                                                                [value]="rowIndex"
                                                                                (change)="handleAcreditaDocumentoEvaluacionExpedienteRadioButton($event, row)"
                                                                                [checked]="row.get('acreditaDocumento_'+row.get('idCodigoPadre').value).value"
                                                                                >
                                                                            </mat-radio-button>
                                                                        </mat-radio-group>
                                                                    </div>
                                                                    <div *ngIf="(!getTienePadre(row) && !row.get('tieneSubCriterio').value && !getTieneValorMaximo(row))">
                                                                        <mat-checkbox formControlName="acreditaDocumento"
                                                                            [disabled]="esDesabilitado"
                                                                            (change)="handleAcreditaDocumentoEvaluacionExpedienteCheckbox($event, row)"
                                                                            [checked]="row.get('acreditaDocumentoSeleccionado').value">
                                                                        </mat-checkbox>
                                                                    </div>
                                                                    <div *ngIf="(!getTienePadre(row) && !row.get('tieneSubCriterio').value && getTieneValorMaximo(row))">
                                                                        <mat-checkbox formControlName="acreditaDocumento"
                                                                            [disabled]="esDesabilitado"
                                                                            (change)="handleAcreditaDocumentoEvaluacionExpedienteCheckboxInput($event, row)"
                                                                            [checked]="row.get('acreditaDocumentoSeleccionado').value">
                                                                        </mat-checkbox>
                                                                    </div>
                                                                </td>
                                                                <td mat-footer-cell *matFooterCellDef> </td>
                                                            </ng-container>
                                                            <ng-container matColumnDef="cantidadCertificados">
                                                                <th mat-header-cell *matHeaderCellDef>Cantidad
                                                                    certificados
                                                                </th>
                                                                <td mat-cell *matCellDef="let row;let rowIndex = index" [formGroup]="row">
                                                                    <div *ngIf="row.get('tieneCantidad').value"> 
                                                                        <mat-form-field floatLabel="never">
                                                                            <input matInput formControlName="cantidadCertificados"
                                                                            [attr.data-sectionvalue]="rowIndex"
                                                                            (keyup)="handleRecalcularEvaluacionExpedienteInput($event,row)"
                                                                            min="0" numbersOnly>
                                                                        </mat-form-field>
                                                                    </div>
                                                                </td>
                                                                <td mat-footer-cell *matFooterCellDef> </td>
                                                            </ng-container>

                                                            <ng-container matColumnDef="puntaje">
                                                                <th mat-header-cell *matHeaderCellDef> Puntaje
                                                                </th>
                                                                <td mat-cell *matCellDef="let row;let i = index "
                                                                    [formGroup]="row">
                                                                    <div>
                                                                        <input matInput formControlName="puntaje" min="0" numbersOnly ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/">   
                                                                    </div>
                                                                </td>
                                                                <td mat-footer-cell *matFooterCellDef>
                                                                    {{puntajeTotalEvaluacionExpediente}} </td>
                                                            </ng-container>

                                                            <tr mat-header-row
                                                                *matHeaderRowDef="displayedEvaluacionExpediente;sticky: true">
                                                            </tr>
                                                            <tr mat-row
                                                                *matRowDef="let row;columns: displayedEvaluacionExpediente"
                                                                (click)="handleRecalcularEvaluacionExpedienteInput($event,row)"
                                                                [ngClass]="{ hovered: row.hovered,selected: selectionEvaluacionExpediente.isSelected(row)}"
                                                                (mouseover)=" row.hovered = true "
                                                                (mouseout)="row.hovered = false"
                                                                [@animate]="{value: '*',params: { y: '100%' }}">
                                                            </tr>
                                                            <tr mat-footer-row
                                                                *matFooterRowDef="displayedEvaluacionExpediente"></tr>
                                                        </table>
                                                    </ng-container>
                                                    <br />
                                                    <div fxLayout="row" fxLayout.lt-md="column">
                                                        <div fxLayout="row" fxLayout.xs="column" fxFlex="100%"
                                                            fxFlex.xs="100%" fxLayoutGap="12px" fxLayoutGap.xs="0">
                                                            <mat-form-field appearance="fill" fxFlex="100%" fxFlex.xs="100%"
                                                                [mineduFormFieldValidationState]="form.get('anotacionesEvaluacionExpediente')">
                                                                <mat-label
                                                                    [mineduFormRequiredLabel]="form.get('anotacionesEvaluacionExpediente')">
                                                                    Anotaciones
                                                                </mat-label>
                                                                <textarea matInput
                                                                    formControlName="anotacionesEvaluacionExpediente"
                                                                    maxlength="400" alphaNumeric uppercase></textarea>
                                                            </mat-form-field>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </mat-tab>
                                </mat-tab-group>
                            </div>
                            <br />
                        </form>
                    </div>
                    <p class="text-danger">(*) Datos obligatorios</p>
                </mat-tab>
            </mat-tab-group>
                </div>

                <div class="panel-footer">
                    <div fxLayout="row" fxLayoutAlign="end center" class="mb-10">

                        <div class="ml-4" *ngIf="this.idOperacion === tipoOperacion.Registrar">
                            <minedu-button-save [mineduForm]="form" [working]="working" (mineduOnClick)="handleRegistrar()">
                            </minedu-button-save>
                        </div>

                        <div class="ml-4" *ngIf="this.idOperacion === tipoOperacion.Modificar">
                            <minedu-button-save [mineduForm]="form" [working]="working" (mineduOnClick)="handleRegistrar()">
                            </minedu-button-save>
                        </div>

                        <div class="ml-4">
                            <button mat-stroked-button (click)="handleRetornar()"><span
                                    class="material-icons">keyboard_backspace</span>
                                RETORNAR</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>